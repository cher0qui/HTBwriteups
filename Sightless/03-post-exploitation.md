## Recon
No podemos usar sudo -l ;

### hosts
Miramos el **/etc/hosts** para encontrar posibles subdominios:
```bash
michael@sightless:~$ cat /etc/hosts
127.0.0.1 localhost
127.0.1.1 sightless
127.0.0.1 sightless.htb sqlpad.sightless.htb admin.sightless.htb
```

### netstat
Usamos el netstat -nlpt para saber que conexiones tenemos habilitadas 
```bash
michael@sightless:~$ netstat -nlpt
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:50451         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:42253         0.0.0.0:*               LISTEN      24744/ssh           
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:34299         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:33813         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::21                   :::*                    LISTEN      -               
```
Encontramos el puerto 8080 en local que parece sospechoso, hacemos pivoting con chisel a nuestra maquina host

En la maquina ==atacante (host)== :
```bash
~$ ./chisel server --reverse -p 4443
2024/11/19 18:24:37 server: Reverse tunnelling enabled
2024/11/19 18:24:37 server: Fingerprint mgcPNujuLSpfpQBzbLkIZboBivlQthrSFr3kTDAsp6A=
2024/11/19 18:24:37 server: Listening on http://0.0.0.0:4443
```

En la maquina ==victima== :

```bash
$ ./chisel client 10.10.11.32:4443 R:8080:127.0.0.1:8080   
2024/11/19 19:43:26 client: Connecting to ws://10.10.11.32:4443
```

![[Pasted image 20241119200213.png]]
O también podemos crear un túnel ssh:
```bash
➜  exploitation ssh michael@sightless.htb -L 8080:127.0.0.1:8080
michael@sightless.htb's password: 
Warning: remote port forwarding failed for listen port 8080
Last login: Tue Nov 19 18:37:04 2024 from 10.10.16.63
```

Una vez realizado el puente encontramos el admin panel de Froxlor en la 127.0.0.1:8080:

![[Pasted image 20241119200602.png]]

Podemos entrar con la cuenta de michael.
### Chrome Remote Debugger
For getting access to Froxlor dashboard, we can use chrome remote debugger exploit 
There is an execution policy issue in PHP-FPM configuration for the user Michael in Foxlor.
[Info](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/chrome-remote-debugger-pentesting/)
![[Pasted image 20241120132610.png]]

```bash
ssh -L 42253:127.0.0.1:42253 michael@sightless.htb
```
![[Pasted image 20241120132745.png]]

![[Pasted image 20241120132829.png]]

![[Pasted image 20241119202313.png]]

![[Pasted image 20241120132929.png]]
In this new window, switch to the “Network” tab and wait for Michael to log in. Monitor the traffic and locate `index.php` to find the credentials required to access the login portal on `127.0.0.1:8080`. Use these credentials to log in.


![[Pasted image 20241120133655.png]]

Entramos en el admin panel :
![[Pasted image 20241120134204.png]]

Nos dirigimos a php>php-fpm-versions y le damos a + create a new php version
![[Pasted image 20241120134313.png]]

![[Pasted image 20241120134541.png]]
Una vez en el panel copiamos el id rsa a una carpeta a la que podamos acceder y le damos permisos de lectura y escritura 
![[Pasted image 20241120134755.png]]

Una vez ya preparados los RCE tenemos que reiniciar el servicio, en la API lo podremos hacer desde settings>>PHP-FP
![[Pasted image 20241120135012.png]]

![[Pasted image 20241120135704.png]]

### Root access 
![[Pasted image 20241120135848.png]]

### Local enumeration

-  netstat -tlnp
-  /etc/hosts

### Atack vector

- Chrome Remote Debugger
- php-fpm (Froxlor)

---



